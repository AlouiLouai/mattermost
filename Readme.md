# Mattermost deployement for personal use

This repository contains the setup for deploying Mattermost with a Dockerized environment for local development and a Render configuration for deployment in the cloud. The deployment uses MinIO as an S3-compatible storage service for media files (images, videos, etc.), and PostgreSQL for storing messages and media between team members.

## Repository Structure
- master branch: Contains the Docker configuration for local development and testing.
- production-beta branch: Contains the Render configuration and necessary Docker adjustments to deploy Mattermost on Render.

## Local Development and Docker Deployment (Master Branch)
This section outlines how to set up and run Mattermost locally using Docker and Docker Compose. It simulates a production environment for local development.

### Prerequisites
- Docker: Ensure that Docker and Docker Compose are installed on your machine. You can install them from the official Docker documentation.
### Setup
1. Clone the repository:

bash```
git clone <repo-url>
cd mattermost-deployment
```

2. Navigate to the master branch:

bash```
git checkout master
```

3. Build and start the services with Docker Compose:
- The docker-compose.yml file includes services for Mattermost, MinIO, and PostgreSQL.

Run the following command to start all services:

bash```
docker-compose up --build
```

This will:

- Build the necessary Docker images for Mattermost and MinIO.
- Start the PostgreSQL service.
- Mount the MinIO disk for file storage.

4. Access Mattermost: Once everything is running, you can access Mattermost by opening your browser and navigating to:

bash```
http://localhost:8065
```

## Deployment on Render (Production-Beta Branch)
The production-beta branch is configured for deployment on Render, a platform-as-a-service (PaaS) solution. In this branch, the application has been modified to fit Render's deployment model, including Docker adjustments and a Render-specific configuration.

### Prerequisites
- Render Account: Sign up for a free account on Render.
- Docker: Ensure Docker is installed locally to test and build Docker images.

### Setup for Render Deployment
1. Clone the repository and switch to the production-beta branch:

bash```
git checkout production-beta
```

2. Create and configure the necessary Render-specific environment variables: These should be added in the Render dashboard when creating the service.

- MINIO_ACCESS_KEY and MINIO_SECRET_KEY: These are automatically generated by Render for security purposes.
- POSTGRES_USER, POSTGRES_PASSWORD, POSTGRES_DB: Database connection details for Mattermost.

3. Configure your render.yaml: The render.yaml file defines the services and environment variables for deployment on Render.

Hereâ€™s an overview of the services defined:

bash```
databases:
  - name: mattermost
    plan: starter

services:
  - type: pserv
    name: mattermost-minio
    env: docker
    dockerfilePath: ./minio/Dockerfile
    dockerContext: ./minio
    autoDeploy: false
    disk:
      name: data
      mountPath: /data
    envVars:
      - key: MINIO_ACCESS_KEY
        generateValue: true
      - key: MINIO_SECRET_KEY
        generateValue: true

  - type: web
    name: mattermost
    env: docker
    plan: starter
    dockerfilePath: ./app/Dockerfile
    dockerContext: ./app
    autoDeploy: false
    disk:
      name: config
      mountPath: /mattermost/config
      sizeGB: 1
    envVars:
      - key: MM_USERNAME
        fromDatabase:
          name: mattermost
          property: user
      - key: MM_PASSWORD
        fromDatabase:
          name: mattermost
          property: password
      - key: MM_DBNAME
        fromDatabase:
          name: mattermost
          property: database
      - key: MM_SQLSETTINGS_DRIVERNAME
        value: postgres
      - key: DB_HOST
        fromDatabase:
          name: mattermost
          property: host
      - key: MM_SERVICESETTINGS_LISTENADDRESS
        value: ":10000"
      - key: MM_FILESETTINGS_DRIVERNAME
        value: amazons3
      - key: MM_FILESETTINGS_AMAZONS3BUCKET
        value: mattermost
      - key: MM_FILESETTINGS_AMAZONS3ACCESSKEYID
        fromService:
          type: pserv
          name: mattermost-minio
          envVarKey: MINIO_ACCESS_KEY
      - key: MM_FILESETTINGS_AMAZONS3SECRETACCESSKEY
        fromService:
          type: pserv
          name: mattermost-minio
          envVarKey: MINIO_SECRET_KEY
      - key: MM_FILESETTINGS_AMAZONS3ENDPOINT
        fromService:
          type: pserv
          name: mattermost-minio
          property: hostport
      - key: MM_FILESETTINGS_AMAZONS3SSL
        value: "false"
```

4. Deploy the Services:
- Push your changes to the production-beta branch.
- Log into the Render dashboard and link your repository.
- Render will automatically detect the services and begin deployment.
- Make sure to configure the environment variables and disk settings via Render's interface.

5. Access Mattermost on Render: Once deployed, you can access your Mattermost instance via the Render-provided URL.
